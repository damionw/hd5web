#! /usr/bin/env bash

first_name="${BASH_SOURCE[0]}"
actual_name="$(readlink -f "${first_name}")"
local_path="$(dirname "${actual_name}")"

. "${local_path}/logging"

hdf5::version() {
    echo "${__HD5WEB_VERSION__}"
}

hdf5::add_files() {
    __HD5WEB_FILES__="$((echo "${__HD5WEB_FILES__}"; echo "${1}") | sed -e 's/^[\s]*//g' -e 's/[\s]*$//g' -e '/^[\s]*$/d')"
}

hdf5::files() {
    echo "${__HD5WEB_FILES__}" | sed -e 's/^[\s]*//g' -e 's/[\s]*$//g' -e '/^[\s]*$/d'
}

hdf5::dir() {
    local _filename="${1:?Need filename}"

    h5dump -n "${_filename}" | awk '
        /^FILE_CONTENTS[ ]/ {
            on=1;
        }

        /^[ ][}]/ {
            on=0;
        }

        {
            if (on) {
                printf("type=\"%s\" path=\"%s\"\n", $1, $2);
            }
        }' on=0
}